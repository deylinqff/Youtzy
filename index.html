<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Sube tu Página Web</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f0f2f5;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }

    .container {
      background: #fff;
      padding: 40px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 500px;
    }

    h1 {
      font-size: 24px;
      color: #2c3e50;
      margin-bottom: 20px;
      text-align: center;
    }

    h2 {
      font-size: 18px;
      color: #34495e;
      margin-top: 30px;
    }

    form {
      margin-top: 10px;
    }

    input[type="file"],
    input[type="text"] {
      width: 100%;
      padding: 10px;
      margin-top: 8px;
      border: 1px solid #ccc;
      border-radius: 8px;
      margin-bottom: 15px;
      font-size: 16px;
    }

    button {
      background-color: #3498db;
      color: white;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      width: 100%;
      font-size: 16px;
      transition: background 0.3s;
    }

    button:hover {
      background-color: #2980b9;
    }

    .status {
      margin-top: 20px;
      text-align: center;
      font-size: 14px;
      color: green;
    }

    .error {
      color: red;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Crear tu propia página web</h1>

    <h2>Subir un archivo ZIP</h2>
    <form id="zipForm" enctype="multipart/form-data">
      <input type="file" name="siteZip" accept=".zip" required>
      <button type="submit">Subir ZIP</button>
    </form>

    <h2>O usar un repositorio de GitHub</h2>
    <form id="githubForm">
      <input type="text" name="repoUrl" placeholder="https://github.com/usuario/repositorio" required>
      <button type="submit">Usar repositorio</button>
    </form>

    <div class="status" id="statusMsg"></div>
  </div>

  <script>
    const express = require('express');
const multer = require('multer');
const unzipper = require('unzipper');
const simpleGit = require('simple-git');
const path = require('path');
const fs = require('fs');
const app = express();

const PORT = process.env.PORT || 3000;
const SITES_DIR = path.join(__dirname, 'sites');
if (!fs.existsSync(SITES_DIR)) fs.mkdirSync(SITES_DIR);

app.use(express.urlencoded({ extended: true }));
app.use('/sites', express.static(SITES_DIR));

// Para recibir HTML
app.get('/', (req, res) => {
  res.sendFile(path.join(__dirname, 'index.html'));
});

// Cargar archivo ZIP
const upload = multer({ dest: 'uploads/' });
app.post('/upload', upload.single('siteZip'), async (req, res) => {
  const siteId = `site_${Date.now()}`;
  const sitePath = path.join(SITES_DIR, siteId);
  fs.mkdirSync(sitePath);

  fs.createReadStream(req.file.path)
    .pipe(unzipper.Extract({ path: sitePath }))
    .on('close', () => {
      fs.unlinkSync(req.file.path); // eliminar ZIP temporal
      res.redirect(`/sites/${siteId}/`);
    })
    .on('error', (err) => {
      console.error('Error descomprimiendo:', err);
      res.status(500).send('Error descomprimiendo el archivo');
    });
});

// Clonar repo de GitHub
app.post('/github', async (req, res) => {
  const repoUrl = req.body.repoUrl;
  const siteId = `site_${Date.now()}`;
  const sitePath = path.join(SITES_DIR, siteId);

  const git = simpleGit();
  try {
    await git.clone(repoUrl, sitePath);
    res.redirect(`/sites/${siteId}/`);
  } catch (err) {
    console.error('Error clonando:', err.message);
    res.status(500).send('Error al clonar el repositorio');
  }
});

app.listen(PORT, () => {
  console.log(`Servidor corriendo en http://localhost:${PORT}`);
});
  </script>
</body>
</html>